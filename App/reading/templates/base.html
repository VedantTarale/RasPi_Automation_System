{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
        <title>Raspi-Automation</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

</head>
<body>
    <div class="container">
        <div class="row">
            <div class="col mt-5">
                <div>
                    <canvas id="myChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <script>
        
        var temp_data = {
            type: 'line',
            data: {
              labels: ['Time1'],
              datasets: [{
                label: 'Temperature',
                data: [55],
                borderWidth: 1
              }]
            },
            options: {
              scales: {
                y: {
                  beginAtZero: true
                }
              }
            }
          };
        const ctx = document.getElementById('myChart');
        var temp_chart = new Chart(ctx, temp_data)
        
        const socket_url = 'ws://localhost:8000/ws/reading/';
        var socket = new WebSocket(socket_url)
        socket.onmessage = function(e){
            var data = JSON.parse(e.data);
            console.log(data);
            temp_vals = data.map(entry => entry.temp)
            time = data.map(entry => {
                let dateObject = new Date(entry.time);
                
                let formattedTime = dateObject.toLocaleTimeString('en-US', {
                    hour: '2-digit',
                    minute: '2-digit',
                    second: '2-digit'
                });
            
                return formattedTime;
            });
            temp_data.data.labels = time
            temp_data.data.datasets[0].data = temp_vals
            temp_chart.update()
        }
        
      </script>
</body>
</html>